<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sahu AI Suite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --bg-color: #020617;
            --text-color: #f1f5f9;
            --panel-bg: rgba(15, 23, 42, 0.8);
            --border-color: rgba(255, 255, 255, 0.05);
            --bubble-ai: #0f172a;
        }

        .light-mode {
            --bg-color: #f8fafc;
            --text-color: #0f172a;
            --panel-bg: rgba(255, 255, 255, 0.9);
            --border-color: rgba(0, 0, 0, 0.1);
            --bubble-ai: #ffffff;
        }

        body {
            height: 100vh;
            height: -webkit-fill-available;
            display: flex;
            flex-direction: column;
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow: hidden;
            transition: background-color 0.3s ease;
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .glass-panel {
            background: var(--panel-bg);
            backdrop-filter: blur(16px);
            border-top: 1px solid var(--border-color);
        }

        .sidebar-transition {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .deepthink-active {
            color: #10b981 !important;
            border-color: #10b981 !important;
            background: rgba(16, 185, 129, 0.1);
        }

        .ai-bubble {
            background-color: var(--bubble-ai);
            border: 1px solid var(--border-color);
        }

        textarea { font-size: 16px !important; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="font-sans">

    <!-- Sidebar Overlay -->
    <div id="sidebarOverlay" class="fixed inset-0 bg-black/60 z-40 hidden backdrop-blur-sm"></div>

    <!-- Left Sidebar -->
    <aside id="sidebar" class="fixed top-0 left-0 h-full w-72 bg-slate-900 border-r border-slate-800 z-50 sidebar-transition -translate-x-full flex flex-col">
        <div class="p-4 border-b border-slate-800 flex justify-between items-center bg-slate-950">
            <h2 class="font-bold text-blue-500">Menu</h2>
            <button id="closeSidebar" class="p-1 text-slate-500">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
        </div>
        
        <div class="flex-1 overflow-y-auto p-4 space-y-6 bg-slate-900">
            <div>
                <label class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-3 block">Models Selection</label>
                <div id="sidebarModelList" class="space-y-1"></div>
            </div>

            <div>
                <label class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-3 block">Chat History</label>
                <div id="historyList" class="space-y-2"></div>
            </div>
        </div>
        
        <div class="p-4 border-t border-slate-800 bg-slate-900">
            <button id="newChatBtn" class="w-full py-2.5 bg-slate-800 hover:bg-slate-700 rounded-xl text-sm font-bold transition-colors text-white">New Chat</button>
        </div>
    </aside>

    <!-- Header -->
    <header class="h-14 flex-none flex items-center justify-between px-4 bg-slate-950/10 border-b border-slate-800/10 z-30">
        <div class="flex items-center gap-3">
            <button id="menuBtn" class="p-1 opacity-70">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
            </button>
            <div class="flex items-center gap-2">
                <div class="w-7 h-7 bg-blue-600 rounded-lg flex items-center justify-center font-bold text-sm text-white">S</div>
                <h1 id="headerTitle" class="text-sm font-bold">Sahu AI</h1>
            </div>
        </div>
        
        <div class="flex items-center gap-2">
            <button id="deepThinkBtn" class="flex items-center gap-1.5 px-2.5 py-1.5 border border-slate-400/20 rounded-lg opacity-70 transition-all">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                </svg>
                <span class="text-[10px] font-bold uppercase hidden sm:inline">DeepThink</span>
            </button>

            <button id="settingsBtn" class="p-2 opacity-70">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                </svg>
            </button>
        </div>
    </header>

    <!-- Main Chat -->
    <main id="chatContainer" class="chat-container p-4 space-y-5"></main>

    <!-- Input -->
    <section class="flex-none glass-panel safe-area-bottom">
        <div id="attachmentPreview" class="hidden px-4 py-2 flex gap-2 overflow-x-auto no-scrollbar"></div>
        <div class="p-3 max-w-4xl mx-auto flex items-end gap-2">
            <label class="flex items-center justify-center h-11 w-11 shrink-0 bg-slate-400/10 border border-slate-400/20 rounded-xl opacity-70 cursor-pointer">
                <input type="file" id="fileInput" class="hidden" multiple>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" /></svg>
            </label>
            <div class="flex-1 bg-slate-400/5 border border-slate-400/20 rounded-2xl overflow-hidden focus-within:border-blue-500/50">
                <textarea id="userInput" rows="1" placeholder="Type a message..." class="w-full bg-transparent border-none px-4 py-3 focus:ring-0 outline-none resize-none max-h-32 min-h-[44px] text-sm"></textarea>
            </div>
            <button id="sendBtn" class="h-11 w-11 bg-blue-600 rounded-xl flex items-center justify-center text-white shadow-lg shrink-0">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" />
                </svg>
            </button>
        </div>
    </section>

    <!-- Combined Settings & Theme Modal -->
    <div id="settingsModal" class="fixed inset-0 bg-black/80 z-[60] hidden flex items-center justify-center p-6 backdrop-blur-md">
        <div class="bg-slate-900 w-full max-w-xs p-6 rounded-3xl border border-slate-800 text-white">
            <h2 class="text-lg font-bold mb-5 flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                </svg>
                Settings
            </h2>
            
            <div class="space-y-6">
                <!-- Theme Section -->
                <div class="space-y-3">
                    <label class="text-[10px] font-black text-slate-500 uppercase tracking-widest">Appearance</label>
                    <button id="themeToggle" class="w-full flex items-center justify-between px-4 py-3 bg-slate-800 rounded-xl hover:bg-slate-700 transition-colors">
                        <span class="text-sm">Theme Mode</span>
                        <div id="themeIcon" class="text-blue-400">
                            <!-- Icon via JS -->
                        </div>
                    </button>
                </div>

                <!-- API Section -->
                <div class="space-y-3">
                    <label class="text-[10px] font-black text-slate-500 uppercase tracking-widest">Mistral API Token</label>
                    <input type="password" id="apiKeyInput" placeholder="Enter Token..." class="w-full bg-slate-950 border border-slate-800 rounded-xl px-4 py-3 text-sm outline-none focus:border-blue-500">
                </div>
            </div>

            <div class="mt-8 space-y-2">
                <button id="saveSettings" class="w-full py-3 bg-blue-600 rounded-xl font-bold text-sm">Save & Close</button>
                <button id="closeSettings" class="w-full py-3 text-slate-500 text-sm">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        const AGENTS = [
            { id: "ag_019bd61b54b07009b15c4210a1ea3dcc", name: "Sahu 1" },
            { id: "ag_019bd61dbc2576018bc51ecd6b949840", name: "Sahu 1 Fast" },
            { id: "ag_019bd61e5c1c751993fd59206f87615c", name: "Sahu 1 Pro" },
            { id: "ag_019bd619ae6c732f81df02ca07f85098", name: "Sahu 2" },
            { id: "ag_019bd61a73807623a04e608019bbd02f", name: "Sahu 2 Pro" },
            { id: "ag_019bd5f77ba5756fb5590cf38001325e", name: "Sahu 3" },
            { id: "ag_019bd5f1a97972cda1b31c884d53c32d", name: "Sahu 3 Fast" },
            { id: "ag_019bd5e9195c72c591ae1de889616331", name: "Sahu 3 Pro" },
            { id: "ag_019bd6150dcf744f81eee10f0d08e98d", name: "Sahu Code 1 Fast" },
            { id: "ag_019bd5fbf4ea711b8ed150d3d56e8219", name: "Sahu Code 1" },
            { id: "ag_019bd612ac2475b591ed0a9a359ac9a2", name: "Sahu Code 2 Fast" },
            { id: "ag_019bd5f4e8f67798a474c29a8a02f2e0", name: "Sahu Code 2" },
            { id: "ag_019bd6169b4c7175b4e7bbe4c40c9ca3", name: "Sahu Code 2 Pro" },
            { id: "ag_019bd60cab2370e8b0bc261f00a67cd7", name: "Sahu Code 3 Fast" },
            { id: "ag_019bd5f9714b7062b5ee3544b9fd095e", name: "Sahu Code 3" },
            { id: "ag_019bd615fbb872f5a2f5dcaaa3de7c80", name: "Sahu Code 3 Pro" }
        ];

        let state = {
            apiKey: localStorage.getItem('sahu_mistral_key') || '',
            activeAgent: AGENTS[0],
            deepThink: false,
            isDarkMode: localStorage.getItem('sahu_theme') !== 'light',
            history: [],
            savedChats: JSON.parse(localStorage.getItem('sahu_chats') || '[]'),
            files: []
        };

        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebarOverlay');
        const chatContainer = document.getElementById('chatContainer');
        const userInput = document.getElementById('userInput');
        const sidebarModelList = document.getElementById('sidebarModelList');
        const historyList = document.getElementById('historyList');
        const headerTitle = document.getElementById('headerTitle');
        const deepThinkBtn = document.getElementById('deepThinkBtn');
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = document.getElementById('themeIcon');

        // --- Theme Logic ---
        function updateThemeUI() {
            if (state.isDarkMode) {
                document.body.classList.remove('light-mode');
                themeIcon.innerHTML = `<svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>`;
                localStorage.setItem('sahu_theme', 'dark');
            } else {
                document.body.classList.add('light-mode');
                themeIcon.innerHTML = `<svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>`;
                localStorage.setItem('sahu_theme', 'light');
            }
        }

        themeToggle.onclick = () => {
            state.isDarkMode = !state.isDarkMode;
            updateThemeUI();
        };

        // --- Sidebar Logic ---
        function toggleSidebar(show) {
            sidebar.style.transform = show ? 'translateX(0)' : 'translateX(-100%)';
            overlay.classList.toggle('hidden', !show);
        }

        function initSidebarModels() {
            sidebarModelList.innerHTML = '';
            AGENTS.forEach(agent => {
                const btn = document.createElement('button');
                btn.className = `w-full text-left px-3 py-2.5 text-xs rounded-lg transition-colors ${state.activeAgent.id === agent.id ? 'bg-blue-600 text-white' : 'text-slate-400 hover:bg-slate-800'}`;
                btn.textContent = agent.name;
                btn.onclick = () => {
                    state.activeAgent = agent;
                    headerTitle.textContent = agent.name;
                    toggleSidebar(false);
                    initSidebarModels();
                    startNewChat();
                };
                sidebarModelList.appendChild(btn);
            });
        }

        function updateHistoryUI() {
            historyList.innerHTML = '';
            if (state.savedChats.length === 0) {
                historyList.innerHTML = '<p class="text-[11px] text-slate-600 italic px-2">No history...</p>';
                return;
            }
            state.savedChats.forEach((chat, idx) => {
                const btn = document.createElement('button');
                btn.className = "w-full text-left px-3 py-2 text-[11px] text-slate-400 hover:bg-slate-800 rounded-lg truncate transition-colors border border-transparent hover:border-slate-700";
                btn.textContent = chat.title || `Chat ${idx + 1}`;
                btn.onclick = () => loadChat(idx);
                historyList.appendChild(btn);
            });
        }

        function startNewChat() {
            if (state.history.length > 2) saveCurrentChat();
            state.history = [];
            chatContainer.innerHTML = `<div class="py-10 text-center opacity-20 text-xs font-bold uppercase tracking-widest">New Session: ${state.activeAgent.name}</div>`;
        }

        function saveCurrentChat() {
            const title = state.history[0]?.content?.substring(0, 30) + '...';
            state.savedChats.unshift({ title, agent: state.activeAgent.id, history: [...state.history] });
            if (state.savedChats.length > 20) state.savedChats.pop();
            localStorage.setItem('sahu_chats', JSON.stringify(state.savedChats));
            updateHistoryUI();
        }

        function loadChat(idx) {
            const chat = state.savedChats[idx];
            state.activeAgent = AGENTS.find(a => a.id === chat.agent) || AGENTS[0];
            state.history = chat.history;
            headerTitle.textContent = state.activeAgent.name;
            chatContainer.innerHTML = '';
            state.history.forEach(m => appendMsg(m.role, m.content));
            toggleSidebar(false);
            initSidebarModels();
        }

        function appendMsg(role, text) {
            const wrap = document.createElement('div');
            wrap.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'}`;
            const bubble = document.createElement('div');
            bubble.className = `max-w-[85%] p-3.5 rounded-2xl text-[13px] leading-relaxed shadow-sm ${role === 'user' ? 'bg-blue-600 text-white rounded-tr-none' : 'ai-bubble text-inherit rounded-tl-none'}`;
            
            if (role === 'assistant' && state.deepThink) {
                bubble.classList.add('border-emerald-500/30', 'bg-emerald-500/5');
            }
            
            bubble.textContent = text;
            wrap.appendChild(bubble);
            chatContainer.appendChild(wrap);
            chatContainer.scrollTo({ top: chatContainer.scrollHeight, behavior: 'smooth' });
        }

        async function onSend() {
            const text = userInput.value.trim();
            if (!text && state.files.length === 0) return;
            if (!state.apiKey) return document.getElementById('settingsModal').classList.remove('hidden');

            const prompt = state.deepThink ? `DeepThink Mode: ${text}` : text;
            appendMsg('user', text || "Sent Attachment");
            
            userInput.value = '';
            userInput.style.height = '44px';
            state.files = [];

            try {
                const res = await fetch('https://api.mistral.ai/v1/conversations', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${state.apiKey}` },
                    body: JSON.stringify({ agent_id: state.activeAgent.id, inputs: [...state.history, { role: "user", content: prompt }] })
                });
                const data = await res.json();
                const reply = data.choices?.[0]?.message?.content || data.outputs?.[0]?.content || "...";
                state.history.push({ role: "user", content: prompt }, { role: "assistant", content: reply });
                appendMsg('assistant', reply);
            } catch (e) {
                appendMsg('assistant', "⚠️ Error: Connection failed.");
            }
        }

        // --- Events ---
        document.getElementById('menuBtn').onclick = () => toggleSidebar(true);
        document.getElementById('closeSidebar').onclick = () => toggleSidebar(false);
        overlay.onclick = () => toggleSidebar(false);
        document.getElementById('newChatBtn').onclick = () => { startNewChat(); toggleSidebar(false); };
        
        deepThinkBtn.onclick = () => {
            state.deepThink = !state.deepThink;
            deepThinkBtn.classList.toggle('deepthink-active', state.deepThink);
        };

        document.getElementById('sendBtn').onclick = onSend;
        userInput.onkeydown = (e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); onSend(); } };
        
        document.getElementById('settingsBtn').onclick = () => {
            document.getElementById('apiKeyInput').value = state.apiKey;
            document.getElementById('settingsModal').classList.remove('hidden');
        };
        document.getElementById('closeSettings').onclick = () => document.getElementById('settingsModal').classList.add('hidden');
        document.getElementById('saveSettings').onclick = () => {
            state.apiKey = document.getElementById('apiKeyInput').value.trim();
            localStorage.setItem('sahu_mistral_key', state.apiKey);
            document.getElementById('settingsModal').classList.add('hidden');
        };

        userInput.oninput = function() { this.style.height = '44px'; this.style.height = this.scrollHeight + 'px'; };

        // Init
        updateThemeUI();
        initSidebarModels();
        updateHistoryUI();
        headerTitle.textContent = state.activeAgent.name;
    </script>
</body>
</html>

